<!-- Existe alguma mensagem de erro de sistema? -->
<% if(order.errors.any?) %>
  <div class="messages alert alert-warning" role="alert">
    <p><%= t('verify_the_following_errors') %>:</p>
    <ul>
      <% order.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
    </ul>
  </div>
<% end %>

<div class="order__form">
  <%= form_with(model: order, local: true) do |form| %>
    <div class="accordion" id="accordionExample">

      <div class="accordion-item">
        <h2 class="accordion-header" id="headingOne">
          <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
            <strong>Remetente</strong>
          </button>
        </h2>
        <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
          <div class="accordion-body">
            <%= form.fields_for :addresses do |a| %>
              <table class="addresss__form table table-success table-striped">
                <%= a.hidden_field :person, value: 'sender', class: "form-control" %>
                <tr>
                  <th><%= a.label :address_one, t('address_one'), class: "form-label" %></th>
                  <td><%= a.text_field :address_one, class: "form-control" %></td>
                </tr>
                <tr>
                  <th><%= a.label :address_two, t('address_two'), class: "form-label" %></th>
                  <td><%= a.text_field :address_two, class: "form-control" %></td>
                </tr>
                <tr>
                  <th><%= a.label :city, t('city'), class: "form-label" %></th>
                  <div>
                    <td>
                      <%= a.text_field :city, class: "form-control" %>
                      <%= a.select :state, Order.states.keys.map { |value| value }, {},
                      { class: "form-select", include_blank: true } %>
                    </td>
                  </div>
                </tr>
                <tr>
                  <th><%= a.label :zip, t('zip'), class: "form-label" %></th>
                  <td><%= a.text_field :zip, class: "form-control" %></td>
                </tr>
              </table>
            <% end %>
          </div>
        </div>
      </div>

      <div class="accordion-item">
        <h2 class="accordion-header" id="headingTwo">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
            <strong>Destinatário</strong>
          </button>
        </h2>
        <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
          <div class="accordion-body">
            <%= form.fields_for :addresses do |b| %>
              <table class="addresss__form table table-success table-striped">
                <%= b.hidden_field :person, value: 'recipient', class: "form-control" %>
                <tr>
                  <th><%= b.label :address_one, t('address_one'), class: "form-label" %></th>
                  <td><%= b.text_field :address_one, class: "form-control" %></td>
                </tr>
                <tr>
                  <th><%= b.label :address_two, t('address_two'), class: "form-label" %></th>
                  <td><%= b.text_field :address_two, class: "form-control" %></td>
                </tr>
                <tr>
                  <th><%= b.label :city, t('city'), class: "form-label" %></th>
                  <div>
                    <td><%= b.text_field :city, class: "form-control" %>
                    <%= b.select :state, Order.states.keys.map { |value| value }, {}, { class: "form-select", include_blank: true } %></td>
                  </div>
                </tr>
                <tr>
                  <th><%= b.label :zip, t('zip'), class: "form-label" %></th>
                  <td><%= b.text_field :zip, class: "form-control" %></td>
                </tr>
              </table>
            <% end %>
          </div>
        </div>
      </div>

      <div class="accordion-item">
        <h2 class="accordion-header" id="headingThree">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
            <strong>Distância</strong>
          </button>
        </h2>
        <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
          <div class="accordion-body">
              <table class="addresss__form table table-success table-striped">
                <tr>
                  <th><%= form.label :distance, t('distance'), class: "form-label" %></th>
                  <td><%= form.text_field :distance, class: "form-control" %></td>
                </tr>
              </table>
          </div>
        </div>
      </div>

      <div class="accordion-item">
        <h2 class="accordion-header" id="headingFour">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
            <strong>Produtos</strong>
          </button>
        </h2>
        <div id="collapseFour" class="accordion-collapse collapse" aria-labelledby="headingFour" data-bs-parent="#accordionExample">
          <div class="accordion-body">
            <table class="product__form table table-success table-striped">
              <thead>
                <tr>
                  <th><%= t('code') %></th>
                  <th><%= t('width') %></th>
                  <th><%= t('height') %></th>
                  <th><%= t('depth') %></th>
                  <th><%= t('weight') %></th>
                  <th>Ações</th>
                </tr>
              </thead>
              <tbody class="order-products">
                <%= form.fields_for :order_products do |order_product| %>
                  <%= render partial: "order_product_fields", locals: { f: order_product } %>
                <% end %>
              </tbody>
            </table>
            <%= link_to_add_association 'Adicionar Produto', form, :order_products,
              'data-association-insertion-node' => ".order-products",
              'data-association-insertion-method' => "append",
              class: "btn btn-secondary" %>
          </div>
        </div>
      </div>

    </div>
    <div class="orders__btn">
      <%= form.submit t('save'), class: "btn btn-success" %>
    </div>
  <% end %>
</div>